---
interface Props {
  navLinks: { href: string; label: string }[];
  toolsLinks: { href: string; label: string }[];
  currentPath: string;
}

const { navLinks, toolsLinks, currentPath } = Astro.props;

const browseLinks = navLinks.filter(({ href }) => href === '/bills' || href === '/not-bills');
const sectionLinks = navLinks.filter(({ href }) => href !== '/bills' && href !== '/not-bills');
const quickLinks = [
  { href: '/bills', label: 'Real Bills' },
  { href: '/not-bills', label: 'Not Bills' },
  { href: '/today', label: 'Today' },
];

function isActivePath(href: string) {
  if (href === '/') return currentPath === '/';
  return currentPath === href || currentPath.startsWith(`${href}/`);
}
---

<div
  id="mobile-menu"
  class="fixed inset-0 z-70 hidden"
  role="dialog"
  aria-modal="true"
  aria-hidden="true"
  aria-labelledby="mobile-menu-title"
>
  <button
    id="mobile-menu-backdrop"
    type="button"
    class="absolute inset-0 bg-navy-950/80 backdrop-blur-sm"
    aria-label="Close menu"></button>

  <aside
    id="mobile-menu-panel"
    class="absolute inset-y-0 right-0 flex w-full max-w-sm translate-x-full flex-col border-l border-navy-700 bg-navy-900 shadow-2xl transition-transform duration-300 ease-out will-change-transform"
    tabindex="-1"
  >
    <div class="flex items-center justify-between border-b border-navy-700 px-4 py-3">
      <p id="mobile-menu-title" class="font-sans text-xs uppercase tracking-[0.25em] text-gold-500">
        Navigation
      </p>
      <button
        id="mobile-menu-close"
        type="button"
        class="rounded-md p-2 text-gold-400 transition-colors hover:bg-navy-800 hover:text-gold-300 focus:outline-none focus:ring-2 focus:ring-gold-400"
        aria-label="Close menu"
      >
        <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"></path>
        </svg>
      </button>
    </div>

    <div class="space-y-3 border-b border-navy-700 px-4 py-3">
      <a
        href="/search"
        data-mobile-link
        class="inline-flex w-full items-center justify-center gap-2 rounded-md border border-gold-500/40 bg-navy-800 px-3 py-2 text-sm font-sans font-medium text-gold-200 transition-colors hover:bg-navy-700"
      >
        <svg
          class="h-4 w-4"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
          stroke-width="2"
          aria-hidden="true"
        >
          <circle cx="11" cy="11" r="8"></circle>
          <path d="m21 21-4.35-4.35" stroke-linecap="round"></path>
        </svg>
        Search Bills
      </a>

      <div class="grid grid-cols-3 gap-2">
        {
          quickLinks.map(({ href, label }) => (
            <a
              href={href}
              data-mobile-link
              aria-current={isActivePath(href) ? 'page' : undefined}
              class:list={[
                'rounded-md border px-2 py-1.5 text-center text-[11px] font-sans font-semibold uppercase tracking-wide transition-colors',
                isActivePath(href)
                  ? 'border-gold-500/60 bg-gold-500/20 text-gold-200'
                  : 'border-navy-700 bg-navy-800 text-gold-300 hover:border-gold-500/60 hover:text-gold-200',
              ]}
            >
              {label}
            </a>
          ))
        }
      </div>
    </div>

    <nav class="flex-1 overflow-y-auto overscroll-contain px-3 py-4">
      {
        browseLinks.length > 0 && (
          <section class="overflow-hidden rounded-lg border border-navy-700">
            <button
              type="button"
              data-mobile-section-toggle="browse"
              aria-expanded="true"
              aria-controls="mobile-section-browse"
              class="flex w-full items-center justify-between bg-navy-800 px-4 py-3 text-left font-sans text-sm font-semibold uppercase tracking-wide text-gold-300"
            >
              Browse Bills
              <svg
                data-mobile-section-icon="browse"
                class="h-4 w-4 transition-transform"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
                stroke-width="2"
              >
                <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
              </svg>
            </button>
            <ul
              id="mobile-section-browse"
              data-mobile-section="browse"
              class="space-y-1 bg-navy-900 p-2"
            >
              {browseLinks.map(({ href, label }) => (
                <li>
                  <a
                    href={href}
                    data-mobile-link
                    aria-current={isActivePath(href) ? 'page' : undefined}
                    class:list={[
                      'block rounded-md px-3 py-2.5 text-sm font-sans transition-colors',
                      isActivePath(href)
                        ? 'bg-gold-500/20 text-gold-200'
                        : 'text-gold-300 hover:bg-navy-800 hover:text-gold-200',
                    ]}
                  >
                    {label}
                  </a>
                </li>
              ))}
            </ul>
          </section>
        )
      }

      {
        sectionLinks.length > 0 && (
          <section class="mt-3 overflow-hidden rounded-lg border border-navy-700">
            <button
              type="button"
              data-mobile-section-toggle="sections"
              aria-expanded="false"
              aria-controls="mobile-section-sections"
              class="flex w-full items-center justify-between bg-navy-800 px-4 py-3 text-left font-sans text-sm font-semibold uppercase tracking-wide text-gold-300"
            >
              Sections
              <svg
                data-mobile-section-icon="sections"
                class="h-4 w-4 transition-transform"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
                stroke-width="2"
              >
                <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
              </svg>
            </button>
            <ul
              id="mobile-section-sections"
              data-mobile-section="sections"
              class="hidden space-y-1 bg-navy-900 p-2"
            >
              {sectionLinks.map(({ href, label }) => (
                <li>
                  <a
                    href={href}
                    data-mobile-link
                    aria-current={isActivePath(href) ? 'page' : undefined}
                    class:list={[
                      'block rounded-md px-3 py-2.5 text-sm font-sans transition-colors',
                      isActivePath(href)
                        ? 'bg-gold-500/20 text-gold-200'
                        : 'text-gold-300 hover:bg-navy-800 hover:text-gold-200',
                    ]}
                  >
                    {label}
                  </a>
                </li>
              ))}
            </ul>
          </section>
        )
      }

      <section class="mt-3 overflow-hidden rounded-lg border border-navy-700">
        <button
          type="button"
          data-mobile-section-toggle="tools"
          aria-expanded="false"
          aria-controls="mobile-section-tools"
          class="flex w-full items-center justify-between bg-navy-800 px-4 py-3 text-left font-sans text-sm font-semibold uppercase tracking-wide text-gold-300"
        >
          Tools
          <svg
            data-mobile-section-icon="tools"
            class="h-4 w-4 transition-transform"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
            stroke-width="2"
          >
            <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"></path>
          </svg>
        </button>
        <ul
          id="mobile-section-tools"
          data-mobile-section="tools"
          class="hidden space-y-1 bg-navy-900 p-2"
        >
          {
            toolsLinks.map(({ href, label }) => (
              <li>
                <a
                  href={href}
                  data-mobile-link
                  aria-current={isActivePath(href) ? 'page' : undefined}
                  class:list={[
                    'block rounded-md px-3 py-2.5 text-sm font-sans transition-colors',
                    isActivePath(href)
                      ? 'bg-gold-500/20 text-gold-200'
                      : 'text-gold-300 hover:bg-navy-800 hover:text-gold-200',
                  ]}
                >
                  {label}
                </a>
              </li>
            ))
          }
        </ul>
      </section>
    </nav>

    <div class="border-t border-navy-700 px-4 py-3 pb-[calc(0.75rem+env(safe-area-inset-bottom))]">
      <p class="text-[11px] font-sans uppercase tracking-wider text-navy-500">
        Session adjourned? Never.
      </p>
      <a
        href="/privacy"
        data-mobile-link
        class="mt-2 inline-flex text-xs font-sans text-gold-400 underline transition-colors hover:text-gold-300"
      >
        Privacy Policy
      </a>
    </div>
  </aside>
</div>
