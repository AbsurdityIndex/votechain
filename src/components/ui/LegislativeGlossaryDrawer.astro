---
/**
 * Legislative Glossary Drawer
 *
 * An educational slide-out drawer explaining bill types, the legislative process,
 * and key congressional terms.
 * Triggered via custom event: 'open-legislative-glossary'
 */
import Icon from './Icon.astro';
import type { ComponentProps } from 'astro/types';
import { getAllBillTypes } from '../../utils/billParser';

type IconName = ComponentProps<typeof Icon>['name'];

const billTypes = getAllBillTypes();

// Group bill types by chamber
const houseBillTypes = billTypes.filter((t) => t.originChamber === 'house');
const senateBillTypes = billTypes.filter((t) => t.originChamber === 'senate');

// Legislative process stages
const processStages: Array<{ id: string; name: string; icon: IconName; description: string }> = [
  {
    id: 'introduction',
    name: 'Introduction',
    icon: 'file-plus',
    description:
      'A bill is introduced by a member of Congress (the sponsor) and assigned a number.',
  },
  {
    id: 'committee',
    name: 'Committee Review',
    icon: 'users',
    description:
      'The bill is referred to relevant committee(s) for hearings, markup, and amendments.',
  },
  {
    id: 'floor',
    name: 'Floor Debate',
    icon: 'message-square',
    description: 'The full chamber debates the bill, proposes amendments, and votes on passage.',
  },
  {
    id: 'other-chamber',
    name: 'Other Chamber',
    icon: 'repeat',
    description: 'If passed, the bill goes to the other chamber for the same process.',
  },
  {
    id: 'conference',
    name: 'Conference',
    icon: 'git-merge',
    description: 'If versions differ, a conference committee reconciles them into a single bill.',
  },
  {
    id: 'president',
    name: 'Presidential Action',
    icon: 'pen-tool',
    description:
      'The President can sign the bill into law, veto it, or take no action (pocket veto).',
  },
];

// Key terms glossary
const keyTerms = [
  {
    term: 'Sponsor',
    definition: 'The member of Congress who introduces a bill.',
  },
  {
    term: 'Cosponsor',
    definition: 'Additional members who formally support a bill after its introduction.',
  },
  {
    term: 'Engrossed Bill',
    definition:
      'The official copy of a bill as passed by one chamber, with all amendments incorporated.',
  },
  {
    term: 'Enrolled Bill',
    definition: 'The final official copy of a bill passed by both chambers, sent to the President.',
  },
  {
    term: 'Cloture',
    definition: 'A Senate procedure to end debate (filibuster) requiring 60 votes.',
  },
  {
    term: 'Filibuster',
    definition: 'Extended Senate debate used to delay or block a vote on a bill.',
  },
  {
    term: 'Markup',
    definition:
      'A committee meeting where members amend and finalize a bill before reporting it out.',
  },
  {
    term: 'Veto',
    definition: 'Presidential rejection of a bill. Can be overridden by 2/3 vote in both chambers.',
  },
  {
    term: 'Pocket Veto',
    definition:
      'When the President takes no action and Congress adjourns within 10 days, killing the bill.',
  },
  {
    term: 'Rider',
    definition: 'An amendment attached to a bill that may be unrelated to the main subject.',
  },
  {
    term: 'Omnibus Bill',
    definition:
      'A single bill that packages together several measures, often spanning multiple policy areas.',
  },
  {
    term: 'Continuing Resolution',
    definition:
      'Temporary funding legislation that maintains government operations at current levels.',
  },
];
---

<!-- Drawer Backdrop -->
<div id="glossary-backdrop" class="drawer-backdrop" aria-hidden="true"></div>

<!-- Slide-out Drawer -->
<aside
  id="glossary-drawer"
  class="glossary-drawer"
  aria-label="Legislative Glossary"
  aria-hidden="true"
>
  <!-- Drawer Header -->
  <header class="drawer-header" data-theme-fixed>
    <div class="header-title">
      <Icon name="book-open" size={20} />
      <h2>Legislative Glossary</h2>
    </div>
    <button id="glossary-drawer-close" class="drawer-close" aria-label="Close drawer">
      <Icon name="x" size={20} />
    </button>
  </header>

  <!-- Drawer Content -->
  <div class="drawer-content">
    <!-- Intro Section -->
    <section class="intro-section">
      <p class="intro-text">
        Understanding Congress doesn't require a law degree. Here's your guide to bill types, the
        legislative process, and key terms.
      </p>
    </section>

    <!-- Bill Types Section -->
    <section class="bill-types-section">
      <h3 class="section-title">
        <Icon name="file-text" size={14} class="section-icon" />
        Bill Types
      </h3>

      <!-- House Types -->
      <div class="chamber-group">
        <h4 class="chamber-label house">
          <Icon name="landmark" size={12} />
          House
        </h4>
        <div class="bill-type-list">
          {
            houseBillTypes.map((bt) => (
              <div class="bill-type-card">
                <div class="bill-type-header">
                  <span class="bill-type-prefix">{bt.prefix}</span>
                  <span class="bill-type-name">{bt.displayName}</span>
                </div>
                <p class="bill-type-desc">{bt.description}</p>
                <div class="bill-type-path">
                  {bt.needsBothChambers && <span class="path-badge bicameral">Both Chambers</span>}
                  {!bt.needsBothChambers && <span class="path-badge unicameral">House Only</span>}
                  {bt.needsPresident && <span class="path-badge president">President</span>}
                </div>
              </div>
            ))
          }
        </div>
      </div>

      <!-- Senate Types -->
      <div class="chamber-group">
        <h4 class="chamber-label senate">
          <Icon name="columns" size={12} />
          Senate
        </h4>
        <div class="bill-type-list">
          {
            senateBillTypes.map((bt) => (
              <div class="bill-type-card">
                <div class="bill-type-header">
                  <span class="bill-type-prefix">{bt.prefix}</span>
                  <span class="bill-type-name">{bt.displayName}</span>
                </div>
                <p class="bill-type-desc">{bt.description}</p>
                <div class="bill-type-path">
                  {bt.needsBothChambers && <span class="path-badge bicameral">Both Chambers</span>}
                  {!bt.needsBothChambers && <span class="path-badge unicameral">Senate Only</span>}
                  {bt.needsPresident && <span class="path-badge president">President</span>}
                </div>
              </div>
            ))
          }
        </div>
      </div>
    </section>

    <!-- Legislative Process Section -->
    <section class="process-section">
      <h3 class="section-title">
        <Icon name="git-branch" size={14} class="section-icon" />
        How a Bill Becomes Law
      </h3>

      <div class="process-timeline">
        {
          processStages.map((stage, i) => (
            <div class="process-stage">
              <div class="stage-indicator">
                <div class="stage-number">{i + 1}</div>
                {i < processStages.length - 1 && <div class="stage-line" />}
              </div>
              <div class="stage-content">
                <div class="stage-header">
                  <Icon name={stage.icon} size={14} class="stage-icon" />
                  <h4 class="stage-name">{stage.name}</h4>
                </div>
                <p class="stage-desc">{stage.description}</p>
              </div>
            </div>
          ))
        }
      </div>
    </section>

    <!-- Key Terms Section -->
    <section class="terms-section">
      <h3 class="section-title">
        <Icon name="help-circle" size={14} class="section-icon" />
        Key Terms
      </h3>

      <dl class="terms-list">
        {
          keyTerms.map((item) => (
            <div class="term-item">
              <dt class="term">{item.term}</dt>
              <dd class="definition">{item.definition}</dd>
            </div>
          ))
        }
      </dl>
    </section>

    <!-- Disclaimer -->
    <section class="disclaimer-section">
      <p>
        <strong>Note:</strong> This is a simplified overview. The actual legislative process has many
        more procedures, rules, and exceptions. For official information, visit{' '}
        <a
          href="https://www.congress.gov/help/learn-about-the-legislative-process"
          target="_blank"
          rel="noopener noreferrer"
        >
          Congress.gov
        </a>.
      </p>
    </section>
  </div>

  <!-- Drawer Footer -->
  <footer class="drawer-footer" data-theme-fixed>
    <a
      href="https://www.congress.gov/help/learn-about-the-legislative-process"
      target="_blank"
      rel="noopener noreferrer"
      class="learn-more-link"
    >
      <span>Learn more at Congress.gov</span>
      <Icon name="external-link" size={12} />
    </a>
  </footer>
</aside>

<style>
  /* ========================
     BACKDROP
     ======================== */
  .drawer-backdrop {
    position: fixed;
    inset: 0;
    z-index: 45;
    background: rgba(10, 22, 40, 0.6);
    backdrop-filter: blur(2px);
    opacity: 0;
    visibility: hidden;
    transition: all 0.3s ease;
  }

  .drawer-backdrop.open {
    opacity: 1;
    visibility: visible;
  }

  /* ========================
     DRAWER PANEL
     ======================== */
  .glossary-drawer {
    position: fixed;
    top: 0;
    right: 0;
    bottom: 0;
    z-index: 50;
    width: 100%;
    max-width: 440px;
    display: flex;
    flex-direction: column;
    background: var(--color-cream-100);
    border-left: 4px solid var(--color-navy-600);
    box-shadow:
      -12px 0 40px rgba(0, 0, 0, 0.35),
      inset 2px 0 8px rgba(0, 0, 0, 0.05);
    transform: translateX(100%);
    transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .glossary-drawer.open {
    transform: translateX(0);
  }

  /* ========================
     DRAWER HEADER
     ======================== */
  .drawer-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 1rem 1.25rem;
    background: linear-gradient(180deg, var(--color-navy-900) 0%, var(--color-navy-800) 100%);
    border-bottom: 3px solid var(--color-navy-600);
  }

  .header-title {
    display: flex;
    align-items: center;
    gap: 0.625rem;
    color: var(--color-cream-100);
  }

  .header-title h2 {
    font-family: var(--font-serif);
    font-size: 1.25rem;
    font-weight: 600;
    margin: 0;
    letter-spacing: 0.01em;
  }

  .drawer-close {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 2rem;
    height: 2rem;
    background: transparent;
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 0.25rem;
    color: var(--color-cream-300);
    cursor: pointer;
    transition: all 0.2s ease;
  }

  .drawer-close:hover {
    background: rgba(255, 255, 255, 0.1);
    border-color: var(--color-cream-300);
    color: white;
  }

  /* ========================
     CONTENT AREA
     ======================== */
  .drawer-content {
    flex: 1;
    overflow-y: auto;
    padding: 1.5rem 1.25rem;
  }

  /* Intro */
  .intro-section {
    margin-bottom: 1.5rem;
    padding-bottom: 1.25rem;
    border-bottom: 1px solid var(--color-cream-300);
  }

  .intro-text {
    font-family: var(--font-serif);
    font-size: 0.9375rem;
    font-style: italic;
    line-height: 1.6;
    color: var(--color-navy-700);
    margin: 0;
  }

  /* Section titles */
  .section-title {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-family: var(--font-sans);
    font-size: 0.6875rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    color: var(--color-navy-500);
    margin: 0 0 1rem;
  }

  .section-icon {
    color: var(--color-navy-400);
  }

  /* ========================
     BILL TYPES SECTION
     ======================== */
  .bill-types-section {
    margin-bottom: 1.5rem;
  }

  .chamber-group {
    margin-bottom: 1.25rem;
  }

  .chamber-label {
    display: flex;
    align-items: center;
    gap: 0.375rem;
    font-family: var(--font-sans);
    font-size: 0.6875rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    padding: 0.375rem 0.625rem;
    border-radius: 0.25rem;
    margin: 0 0 0.625rem;
  }

  .chamber-label.house {
    background: rgba(59, 130, 246, 0.1);
    color: #2563eb;
  }

  .chamber-label.senate {
    background: rgba(139, 92, 246, 0.15);
    color: #7c3aed;
  }

  .bill-type-list {
    display: flex;
    flex-direction: column;
    gap: 0.625rem;
  }

  .bill-type-card {
    padding: 0.75rem;
    background: white;
    border-radius: 0.5rem;
    border: 1px solid var(--color-cream-300);
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.04);
  }

  .bill-type-header {
    display: flex;
    align-items: baseline;
    gap: 0.5rem;
    margin-bottom: 0.375rem;
  }

  .bill-type-prefix {
    font-family: var(--font-mono);
    font-size: 0.75rem;
    font-weight: 700;
    color: var(--color-navy-900);
    background: var(--color-cream-200);
    padding: 0.125rem 0.375rem;
    border-radius: 0.25rem;
  }

  .bill-type-name {
    font-family: var(--font-serif);
    font-size: 0.8125rem;
    font-weight: 600;
    color: var(--color-navy-800);
  }

  .bill-type-desc {
    font-family: var(--font-sans);
    font-size: 0.6875rem;
    line-height: 1.5;
    color: var(--color-navy-600);
    margin: 0 0 0.5rem;
  }

  .bill-type-path {
    display: flex;
    flex-wrap: wrap;
    gap: 0.375rem;
  }

  .path-badge {
    font-family: var(--font-sans);
    font-size: 0.5625rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    padding: 0.125rem 0.375rem;
    border-radius: 9999px;
  }

  .path-badge.bicameral {
    background: #dbeafe;
    color: #1e40af;
  }

  .path-badge.unicameral {
    background: #e0e7ff;
    color: #4338ca;
  }

  .path-badge.president {
    background: var(--color-gold-200);
    color: #92400e;
  }

  /* ========================
     PROCESS SECTION
     ======================== */
  .process-section {
    margin-bottom: 1.5rem;
    padding-top: 1.25rem;
    border-top: 1px solid var(--color-cream-300);
  }

  .process-timeline {
    display: flex;
    flex-direction: column;
  }

  .process-stage {
    display: flex;
    gap: 0.75rem;
  }

  .stage-indicator {
    display: flex;
    flex-direction: column;
    align-items: center;
    width: 1.75rem;
    flex-shrink: 0;
  }

  .stage-number {
    width: 1.5rem;
    height: 1.5rem;
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--color-navy-800);
    color: white;
    font-family: var(--font-mono);
    font-size: 0.6875rem;
    font-weight: 700;
    border-radius: 50%;
  }

  .stage-line {
    flex: 1;
    width: 2px;
    background: var(--color-cream-300);
    margin: 0.25rem 0;
    min-height: 2rem;
  }

  .stage-content {
    flex: 1;
    padding-bottom: 1rem;
  }

  .stage-header {
    display: flex;
    align-items: center;
    gap: 0.375rem;
    margin-bottom: 0.25rem;
  }

  .stage-icon {
    color: var(--color-gold-600);
  }

  .stage-name {
    font-family: var(--font-serif);
    font-size: 0.8125rem;
    font-weight: 600;
    color: var(--color-navy-900);
    margin: 0;
  }

  .stage-desc {
    font-family: var(--font-sans);
    font-size: 0.6875rem;
    line-height: 1.5;
    color: var(--color-navy-600);
    margin: 0;
  }

  /* ========================
     TERMS SECTION
     ======================== */
  .terms-section {
    margin-bottom: 1.5rem;
    padding-top: 1.25rem;
    border-top: 1px solid var(--color-cream-300);
  }

  .terms-list {
    display: flex;
    flex-direction: column;
    gap: 0.625rem;
    margin: 0;
  }

  .term-item {
    padding: 0.625rem 0.75rem;
    background: white;
    border-radius: 0.375rem;
    border-left: 3px solid var(--color-navy-600);
  }

  .term {
    font-family: var(--font-serif);
    font-size: 0.8125rem;
    font-weight: 700;
    color: var(--color-navy-900);
    margin-bottom: 0.125rem;
  }

  .definition {
    font-family: var(--font-sans);
    font-size: 0.6875rem;
    line-height: 1.45;
    color: var(--color-navy-600);
    margin: 0;
  }

  /* ========================
     DISCLAIMER
     ======================== */
  .disclaimer-section {
    padding: 0.875rem 1rem;
    background: var(--color-navy-800);
    border-radius: 0.5rem;
  }

  .disclaimer-section p {
    font-family: var(--font-sans);
    font-size: 0.6875rem;
    line-height: 1.5;
    color: var(--color-cream-300);
    margin: 0;
  }

  .disclaimer-section strong {
    color: var(--color-cream-100);
  }

  .disclaimer-section a {
    color: var(--color-gold-400);
    text-decoration: underline;
    text-underline-offset: 2px;
  }

  .disclaimer-section a:hover {
    color: var(--color-gold-300);
  }

  /* ========================
     DRAWER FOOTER
     ======================== */
  .drawer-footer {
    padding: 0.75rem 1.25rem;
    background: var(--color-navy-900);
    border-top: 1px solid var(--color-navy-700);
    text-align: center;
  }

  .learn-more-link {
    display: inline-flex;
    align-items: center;
    gap: 0.375rem;
    color: var(--color-cream-300);
    font-family: var(--font-serif);
    font-size: 0.8125rem;
    font-weight: 500;
    text-decoration: none;
    transition: color 0.2s ease;
  }

  .learn-more-link:hover {
    color: white;
  }

  /* ========================
     DARK MODE
     ======================== */
  :global(html.dark) .glossary-drawer {
    background: var(--color-cream-200);
    border-left-color: var(--color-navy-500);
  }

  :global(html.dark) .drawer-content {
    background: var(--color-cream-300);
  }

  :global(html.dark) .intro-text,
  :global(html.dark) .bill-type-desc,
  :global(html.dark) .stage-desc,
  :global(html.dark) .definition {
    color: var(--color-navy-700);
  }

  :global(html.dark) .bill-type-name,
  :global(html.dark) .stage-name,
  :global(html.dark) .term {
    color: var(--color-navy-900);
  }

  :global(html.dark) .bill-type-card,
  :global(html.dark) .term-item {
    background: rgba(0, 0, 0, 0.2);
    border-color: rgba(255, 255, 255, 0.1);
  }

  :global(html.dark) .bill-type-prefix {
    background: rgba(255, 255, 255, 0.1);
    color: var(--color-navy-900);
  }

  :global(html.dark) .intro-section,
  :global(html.dark) .process-section,
  :global(html.dark) .terms-section {
    border-color: rgba(255, 255, 255, 0.1);
  }

  :global(html.dark) .stage-line {
    background: rgba(255, 255, 255, 0.15);
  }

  :global(html.dark) .chamber-label.house {
    background: rgba(59, 130, 246, 0.2);
    color: #60a5fa;
  }

  :global(html.dark) .chamber-label.senate {
    background: rgba(139, 92, 246, 0.2);
    color: #a78bfa;
  }

  :global(html.dark) .path-badge.bicameral {
    background: rgba(59, 130, 246, 0.2);
    color: #93c5fd;
  }

  :global(html.dark) .path-badge.unicameral {
    background: rgba(139, 92, 246, 0.2);
    color: #c4b5fd;
  }

  :global(html.dark) .path-badge.president {
    background: rgba(197, 165, 114, 0.2);
    color: var(--color-gold-400);
  }

  /* ========================
     RESPONSIVE
     ======================== */
  @media (max-width: 480px) {
    .glossary-drawer {
      max-width: 100%;
    }

    .drawer-content {
      padding: 1.25rem 1rem;
    }

    .bill-type-card,
    .term-item {
      padding: 0.625rem;
    }
  }

  /* Print: hide */
  @media print {
    .glossary-drawer,
    .drawer-backdrop {
      display: none !important;
    }
  }
</style>

<script>
  // Drawer functionality
  const drawer = document.getElementById('glossary-drawer');
  const backdrop = document.getElementById('glossary-backdrop');
  const closeBtn = document.getElementById('glossary-drawer-close');

  function openDrawer() {
    drawer?.classList.add('open');
    drawer?.setAttribute('aria-hidden', 'false');
    backdrop?.classList.add('open');
    backdrop?.setAttribute('aria-hidden', 'false');
    document.body.style.overflow = 'hidden';
  }

  function closeDrawer() {
    drawer?.classList.remove('open');
    drawer?.setAttribute('aria-hidden', 'true');
    backdrop?.classList.remove('open');
    backdrop?.setAttribute('aria-hidden', 'true');
    document.body.style.overflow = '';
  }

  // Event listeners - open via custom event
  document.addEventListener('open-legislative-glossary', openDrawer);
  closeBtn?.addEventListener('click', closeDrawer);
  backdrop?.addEventListener('click', closeDrawer);

  // Escape key to close
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && drawer?.classList.contains('open')) {
      closeDrawer();
    }
  });
</script>
