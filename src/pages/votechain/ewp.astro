---
import BaseLayout from '../../layouts/BaseLayout.astro';
import MermaidClient from '../../components/votechain/MermaidClient.astro';
import AISummarizer from '../../components/votechain/AISummarizer.astro';
import { Content as PRDContent } from '../../../PRD-VOTECHAIN-ELECTION-WEB-PROTOCOL.md';
---

<BaseLayout
  title="VoteChain EWP â€” Election Web Protocol"
  description="Ballot integrity protocol completing VoteChain: cryptographic chain of custody from cast to tally via encrypted ballots, public bulletin board, threshold decryption, and end-to-end verifiable proofs."
  ogType="article"
  article={{
    publishedTime: '2026-02-08',
    author: 'Absurdity Index',
    section: 'Policy',
    tags: ['votechain', 'ewp', 'ballot integrity', 'end-to-end verifiability', 'election security'],
  }}
>
  <div class="max-w-4xl mx-auto px-4 py-8">
    <div class="text-center mb-6">
      <p class="text-xs text-gold-600 font-mono uppercase tracking-widest mb-1">Protocol Draft</p>
      <h1 class="font-serif text-2xl md:text-3xl text-navy-900 font-bold">VoteChain EWP</h1>
      <p class="text-navy-600 font-serif italic mt-2 text-sm">Election Web Protocol (EWP) &mdash; Ballot Integrity Layer</p>
    </div>

    <AISummarizer
      triggerSub="The ballot integrity protocol &rarr; 60 seconds"
      scanLines={[
        'Reading EWP protocol specification...',
        'Analyzing challenge-cast protocol...',
        'Cross-referencing bulletin board design...',
        'Evaluating threshold decryption model...',
        'Compiling summary...',
      ]}
    >
      <Fragment slot="eli5">
        <p class="font-bold text-lg text-navy-900 mb-3">The sealed envelope version:</p>

        <p class="font-bold text-navy-900 mt-4 mb-2">What is this?</p>
        <p class="mb-3">VoteChain (the first document) figured out how to check that you're allowed to vote. But once you fill in your ballot, what happens to it? Today, your ballot goes into a box, onto a truck, into a counting room &mdash; and you just have to <em>trust</em> that nothing goes wrong along the way. EWP is the plan for making that entire journey provable with math instead of trust.</p>

        <p class="font-bold text-navy-900 mt-4 mb-2">How it works (the sealed envelope):</p>
        <p class="mb-3">Imagine you write your vote on a piece of paper and put it inside a special sealed envelope that nobody can open &mdash; not the mail carrier, not the person at the front desk, nobody. Only a group of five locksmiths working together can open it, and at least three of them have to agree before the lock turns.</p>

        <ul class="list-disc pl-6 space-y-2.5 mb-4">
          <li><strong>Your envelope has a special window.</strong> Before you seal your ballot for real, you can ask the machine: "Show me what you actually put inside." If it matches what you chose, great &mdash; seal it and send it. If it doesn't match, the machine got caught cheating. Throw that envelope away and try again. This is the "challenge" &mdash; like checking the machine's homework before turning it in.</li>
          <li><strong>Every envelope goes on a public bulletin board.</strong> Think of a giant corkboard in the town square. Once your sealed envelope is pinned up there, everyone can see it's there &mdash; but nobody can read what's inside. And nobody can take it down or swap it out, because everyone's watching.</li>
          <li><strong>You get a receipt.</strong> Not a receipt that shows <em>who you voted for</em> (that would let someone bribe or threaten you), but a receipt that proves your sealed envelope is on the board. You can check later: "Yep, my envelope is still there, untouched."</li>
          <li><strong>At counting time, the locksmiths work together.</strong> They don't open envelopes one by one (that would reveal individual votes). Instead, all the sealed numbers get added up <em>while still sealed</em>, and only the final total gets unlocked. Three of the five locksmiths have to cooperate, and they each show their work so anyone can check the math.</li>
          <li><strong>The whole thing works the same everywhere.</strong> Whether you're voting at a polling place, at a military base overseas, or (someday, with extra safeguards) from home &mdash; the sealed envelope, the bulletin board, and the locksmiths work exactly the same way.</li>
        </ul>

        <p class="font-bold text-navy-900 mt-4 mb-2">Why does this matter?</p>
        <p class="mb-3">Right now, once your ballot leaves your hands, you have to trust a chain of people and machines. With EWP, you can <em>prove</em> three things yourself:</p>
        <ul class="list-disc pl-6 space-y-2.5 mb-4">
          <li><strong>Your vote was sealed correctly</strong> (the challenge test)</li>
          <li><strong>Your sealed vote was recorded</strong> (check the bulletin board)</li>
          <li><strong>All the sealed votes were counted correctly</strong> (anyone can verify the locksmith math)</li>
        </ul>

        <p class="font-bold text-navy-900 mt-4 mb-2">What about voting from home?</p>
        <p class="mb-3">The document says: not yet. Voting at a polling place or supervised location comes first. Voting from your own phone or computer has extra problems &mdash; someone could watch over your shoulder, or your phone could have a virus. The plan has a strict checklist of safety tests that <em>must</em> pass before home voting is allowed. It's a locked gate, not a "maybe later."</p>

        <p class="font-bold text-navy-900 mt-4 mb-2">What it doesn't do:</p>
        <p class="mb-3">It doesn't reveal who you voted for. It doesn't require the internet for in-person voting. It doesn't replace paper ballots where jurisdictions want to keep them. And no single person or organization can cheat the system alone.</p>

        <p class="text-navy-500 text-sm italic mt-4">Want more detail? Slide the bar to the right. Or close this and read the full protocol specification.</p>
      </Fragment>

      <Fragment slot="plain">
        <p class="font-bold text-lg text-navy-900 mb-3">Here's what this protocol does:</p>

        <p class="font-bold text-navy-900 mt-4 mb-2">What is EWP?</p>
        <p class="mb-3">The VoteChain PRD solved voter <em>verification</em> &mdash; proving you're a citizen, eligible, alive, and haven't already voted. But it deliberately stopped there. It didn't touch what happens to your ballot after you cast it. Today, that journey &mdash; from the moment you fill in your choices to the published election results &mdash; relies on physical chain of custody: sealed boxes, transport vans, counting rooms, certified machines. Every link in that chain is a trust assumption, not a mathematical proof.</p>
        <p class="mb-3"><strong>EWP is the cryptographic chain of custody.</strong> It's the protocol that ensures every ballot is encrypted, recorded on a public log, provably included in the final count, and counted correctly &mdash; all verifiable by anyone, with no trust assumptions on any single device, person, or agency.</p>

        <p class="font-bold text-navy-900 mt-4 mb-2">The three verifiability guarantees:</p>
        <p class="mb-3">EWP delivers what's called <strong>end-to-end verifiability (E2E-V)</strong> &mdash; a complete, unbroken chain of proof from your selections to the final tally:</p>
        <ul class="list-disc pl-6 space-y-2.5 mb-4">
          <li><strong>Cast-as-intended:</strong> You can verify that the voting device actually encrypted your real selections, not something else. This works through a "challenge" mechanism: before casting for real, you can ask the device to reveal how it encrypted your ballot. If it matches your choices, the device is honest. If not, you've caught it cheating. The device can't predict which ballots will be challenged, so it can't selectively cheat.</li>
          <li><strong>Recorded-as-cast:</strong> After casting, you get a receipt with a unique identifier for your encrypted ballot. You can check a public log (the "bulletin board") to confirm your ballot is recorded there. The log entries are anchored on the VoteChain ledger, so no one can rewrite history.</li>
          <li><strong>Counted-as-recorded:</strong> At election close, the encrypted ballots are tallied and the results are published along with mathematical proofs that anyone &mdash; election officials, journalists, academics, your neighbor &mdash; can independently verify. The proofs show that the published tally matches exactly the set of recorded ballots.</li>
        </ul>

        <p class="font-bold text-navy-900 mt-4 mb-2">How ballot secrecy is preserved:</p>
        <ul class="list-disc pl-6 space-y-2.5 mb-4">
          <li>Ballots are encrypted under a special election key that no single person holds. The key is split among multiple independent "trustees" (think: five different organizations, each holding one piece). At least three of five must cooperate to decrypt anything &mdash; and they only decrypt the aggregate tally, never individual ballots.</li>
          <li>The receipt you get proves your ballot is <em>recorded</em>, but it cannot reveal your <em>selections</em>. Even if someone demanded to see your receipt, they couldn't learn how you voted from it.</li>
        </ul>

        <p class="font-bold text-navy-900 mt-4 mb-2">The bulletin board:</p>
        <p class="mb-3">Think of it as a public, append-only ledger &mdash; like a glass-walled filing cabinet where everyone can see the sealed envelopes going in, but nobody can read the contents, remove anything, or rearrange the order. The bulletin board publishes signed checkpoints that are anchored on VoteChain, so any attempt to show different people different versions of the log gets detected by independent monitors.</p>

        <p class="font-bold text-navy-900 mt-4 mb-2">Three deployment modes:</p>
        <ul class="list-disc pl-6 space-y-2.5 mb-4">
          <li><strong>Mode 1 &mdash; Polling place (primary):</strong> Voter uses an institution-controlled device at a polling place. Physical environment handles coercion resistance (privacy booth, poll workers). This is the first deployment target and replaces the physical chain of custody with cryptographic proof.</li>
          <li><strong>Mode 2 &mdash; Supervised remote:</strong> Military bases, consulates, supervised kiosks. Same protocol, same cryptography, same guarantees. Physical supervision provides the coercion-resistant environment.</li>
          <li><strong>Mode 3 &mdash; Unsupervised remote (future, gated):</strong> Personal phone or computer. This mode has the highest risk &mdash; coercion, device malware, and phishing. EWP defines a strict set of seven gate criteria that must all be independently validated before any Mode 3 deployment. Modes 1 and 2 do not wait for Mode 3.</li>
        </ul>

        <p class="font-bold text-navy-900 mt-4 mb-2">Threat model:</p>
        <p class="mb-3">EWP defends against network attackers, compromised gateways, insider operators, malicious voters, compromised voter devices, and trustee collusion. The protocol is designed so that no single point of compromise can silently alter the election outcome. The Benaloh challenge catches cheating devices; threshold decryption prevents any small group from seeing individual votes; the public bulletin board prevents ballot suppression; and VoteChain anchoring prevents log manipulation.</p>

        <p class="font-bold text-navy-900 mt-4 mb-2">Built on proven technology:</p>
        <p class="mb-3">The baseline cryptographic suite is designed to be compatible with <strong>ElectionGuard</strong>, an open-source SDK from Microsoft Research that has been used in real U.S. public elections in Wisconsin, California, Idaho, Utah, and Maryland. EWP adds the HTTP transport layer, VoteChain anchoring, and bulletin board transparency on top.</p>

        <p class="font-bold text-navy-900 mt-4 mb-2">Open questions (4 general + 7 Mode 3 gates):</p>
        <p class="mb-3">Which specific encryption suite for pilot certification, trustee threshold governance at federal vs. state level, conformance test vectors for independent implementations, and monitor diversity enforcement. Plus seven hard gate criteria for Mode 3: coercion mitigation effectiveness, network privacy, client integrity for uncontrolled devices, revoting policy, phishing defense, equity and access parity, and independent certification.</p>

        <p class="text-navy-500 text-sm italic mt-4">Close this modal and keep reading for the full protocol specification with sequence diagrams, HTTP API definitions, crypto suite details, security proof sketches, and more.</p>
      </Fragment>

      <Fragment slot="technical">
        <p class="font-bold text-lg text-navy-900 mb-3">Technical summary:</p>

        <p class="font-bold text-navy-900 mt-4 mb-2">Scope:</p>
        <p class="mb-3">An end-to-end ballot integrity protocol completing the VoteChain verification layer. EWP defines the cryptographic chain of custody from ballot casting to tally publication &mdash; encrypted ballots, a public append-only bulletin board (BB), threshold decryption, and verifiable tally proofs. Deployment-mode agnostic: identical protocol primitives across polling-place devices, supervised kiosks, and (gated) personal devices. Designed for controlled pilots, red teaming, and NIST/EAC/CISA standards work.</p>

        <p class="font-bold text-navy-900 mt-4 mb-2">E2E verifiability chain:</p>
        <ul class="list-disc pl-6 space-y-2.5 mb-4">
          <li><strong>P0 &mdash; Cast-as-intended (Benaloh challenge):</strong> Device commits to ciphertext <code>C = Enc(PK_e, m; r)</code> before knowing whether voter will challenge or cast. On challenge, device reveals randomness <code>r</code>; voter (or independent verifier) recomputes <code>Enc(PK_e, m_expected; r)</code> and checks equality. Reduces to IND-CPA binding of the encryption scheme and unpredictability of the challenge decision. Detection probability: <code>1 - (1-p)^(n*f)</code> where <code>p</code> = challenge rate, <code>f</code> = cheating rate, <code>n</code> = ballot count. Compatible with ElectionGuard's <code>CiphertextBallot.challenge()</code> / <code>cast()</code> API.</li>
          <li><strong>P4 &mdash; Recorded-as-cast:</strong> Receipt includes <code>bb_leaf_hash</code> + BB Signed Tree Head (STH). BB provides Merkle inclusion proof. STH roots anchored on VoteChain &mdash; BB cannot rewrite history without equivocation detection by monitors.</li>
          <li><strong>P5 &mdash; Counted-as-recorded:</strong> Tally references BB closing STH root. Trustees publish decryption/shuffle proofs. Auditors verify proofs against the recorded ciphertext set. Reduces to soundness of the tally proof system + correctness of BB set commitment.</li>
        </ul>

        <p class="font-bold text-navy-900 mt-4 mb-2">Baseline crypto suite (<code>ewp_suite_eg_elgamal_v1</code>):</p>
        <ul class="list-disc pl-6 space-y-2.5 mb-4">
          <li><strong>Encryption:</strong> Exponential ElGamal over a prime-order group <code>G</code> (allowlisted: <code>modp_3072</code>, <code>ristretto255</code>, etc.). Selection <code>m</code> encoded as <code>g^m</code>; ciphertext <code>(a, b) = (g^r, PK_e^r * g^m)</code>.</li>
          <li><strong>Election key:</strong> <code>PK_e = g^x</code> where <code>x</code> is threshold-split among <code>n</code> trustees with threshold <code>t</code>. Key ceremony transcripts and hashes anchored on VoteChain.</li>
          <li><strong>Ballot validity proofs:</strong> Non-interactive ZKPs via Fiat-Shamir (sigma protocols). Disjunctive Chaum-Pedersen for <code>m in &#123;0,1&#125;</code>; contest constraint proofs for selection limits. Deterministic transcript: <code>FS = H("ewp:fs:v1" || election_id || manifest_id || contest_id || ciphertexts || context)</code>.</li>
          <li><strong>Homomorphic tally:</strong> Ciphertexts multiply to encryption of the sum: <code>(A, B) = (g^(sum r_i), PK_e^(sum r_i) * g^(sum m_i))</code>. Trustees jointly decrypt <code>B / A^x = g^(sum m_i)</code> with published Chaum-Pedersen partial decryption proofs.</li>
          <li><strong>Reference implementation:</strong> ElectionGuard (MIT license). Used in real U.S. elections (WI, CA, ID, UT, MD). EWP adds HTTP transport (HTTPS, HTTP/2+, TLS 1.3), VoteChain anchoring, and BB transparency.</li>
        </ul>

        <p class="font-bold text-navy-900 mt-4 mb-2">Bulletin board transparency (Merkle log):</p>
        <ul class="list-disc pl-6 space-y-2.5 mb-4">
          <li>Append-only Merkle tree. Each artifact = leaf. Periodic Signed Tree Heads: <code>(tree_size, root_hash, timestamp, signature)</code>. HSM-backed signing key with public <code>kid</code> rotation.</li>
          <li>Non-equivocation (P6): STH roots anchored on VoteChain. Monitors gossip STHs and verify consistency proofs. Minimum 3 independent monitor operators from &ge;2 organizational categories. &ge;99.9% collective coverage during voting windows.</li>
        </ul>

        <p class="font-bold text-navy-900 mt-4 mb-2">HTTP(S) profile:</p>
        <ul class="list-disc pl-6 space-y-2.5 mb-4">
          <li><strong>Discovery:</strong> <code>GET /.well-known/votechain-ewp</code> &rarr; version, issuer, election/BB/VoteChain endpoints, supported suites, JWKS URL.</li>
          <li><strong>Manifest:</strong> JCS-canonicalized signed JSON binding election params, ballot styles, crypto params (<code>PK_e</code>, trustees, threshold), gateway keys. <code>manifest_id = b64u(sha256(canonical_manifest))</code> anchored on VoteChain pre-election.</li>
          <li><strong>Challenge:</strong> <code>POST /challenge</code> &rarr; server nonce (2-5 min TTL). Bound into ZK eligibility proof as public input &mdash; replay prevention.</li>
          <li><strong>Spoil:</strong> <code>POST /spoil</code> &rarr; Benaloh challenge endpoint. No nullifier consumed. Rate limit &ge;3 per session.</li>
          <li><strong>Cast:</strong> <code>POST /cast</code> with idempotency key. Payload: nullifier, ZK eligibility proof, encrypted ballot + validity proof. Response: receipt with <code>bb_leaf_hash</code>, STH, VoteChain anchor <code>tx_id</code>. Async mode supported (<code>cast_pending</code> + poll URL).</li>
          <li><strong>Content types:</strong> <code>application/votechain.ewp.v1+json</code>. Ciphertext/proofs in deterministic CBOR &rarr; <code>base64url</code>.</li>
        </ul>

        <p class="font-bold text-navy-900 mt-4 mb-2">VoteChain on-chain events:</p>
        <ul class="list-disc pl-6 space-y-2.5 mb-4">
          <li><code>election_manifest_published</code> &mdash; pre-election anchor.</li>
          <li><code>ewp_ballot_cast</code> &mdash; per-cast: nullifier, ballot hash, BB leaf/root hash, gateway ID, deployment mode. Chaincode enforces manifest validity, nullifier uniqueness, BB root authorization.</li>
          <li><code>bb_sth_published</code> &mdash; periodic BB checkpoint anchoring.</li>
          <li><code>tally_published</code> &mdash; final tally artifact hash + proof bundle hashes.</li>
        </ul>

        <p class="font-bold text-navy-900 mt-4 mb-2">Security properties and reductions:</p>
        <ul class="list-disc pl-6 space-y-2.5 mb-4">
          <li><strong>P1 (eligibility soundness):</strong> Reduces to VoteChain credential unforgeability + ZK proof soundness. Replay protection via server challenge.</li>
          <li><strong>P2 (uniqueness):</strong> Reduces to collision resistance of <code>H</code> (nullifier) + VoteChain consensus safety.</li>
          <li><strong>P3 (ballot privacy):</strong> Reduces to IND-CPA security of ElGamal under <code>PK_e</code> + threshold assumption (<code>&lt;t</code> trustee collusion).</li>
          <li><strong>P6 (non-equivocation):</strong> Reduces to STH signature unforgeability + monitor coverage diversity.</li>
          <li><strong>P7 (device-independence):</strong> Composite of P0 + P4 + P5 + P6. No single point of compromise can silently alter the outcome.</li>
        </ul>

        <p class="font-bold text-navy-900 mt-4 mb-2">Deployment modes and coercion model:</p>
        <ul class="list-disc pl-6 space-y-2.5 mb-4">
          <li><strong>Mode 1 (in-person):</strong> Primary target. Institution-controlled device with HSM attestation, code signing, tamper-evident housing. Coercion handled by physical environment. Deployment gate: standard EWP conformance.</li>
          <li><strong>Mode 2 (supervised):</strong> UOCAVA, consular, military. Same protocol, supervised device, facility-managed coercion resistance.</li>
          <li><strong>Mode 3 (unsupervised, gated):</strong> Personal device. Full coercion resistance not achievable. Mitigations: revoting extension (monotonic sequence replacing strict nullifier uniqueness; only highest <code>seq</code> at close counted), in-person override. 7 hard gate criteria: coercion mitigation red-team validation, OHTTP/proxy for IP decorrelation, client attestation residual risk quantification, revoting policy, phishing gateway defense UX, equity/access parity, NIST/EAC/CISA independent certification. All gates must clear before any production Mode 3 deployment.</li>
        </ul>

        <p class="font-bold text-navy-900 mt-4 mb-2">Open questions (4 general):</p>
        <p class="mb-3">Concrete ballot encryption suite certification (ElGamal baseline vs. lattice/mixnet alternatives + test vectors), trustee threshold governance model (federal vs. state <code>t/n</code>), conformance test suite for multi-vendor interop, and monitor diversity governance/enforcement mechanism.</p>

        <p class="text-navy-500 text-sm italic mt-4">Full HTTP API schemas, sequence diagrams, Mermaid architecture flows, security proof sketches, error code appendix, and revoting extension sketch are in the document below.</p>
      </Fragment>
    </AISummarizer>

    <!-- Full PRD -->
    <div class="bg-parchment rounded-lg shadow-lg p-8 md:p-12">
      <div class="bill-content prd-content">
        <PRDContent />
      </div>
    </div>
  </div>

  <MermaidClient />
</BaseLayout>
